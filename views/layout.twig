{% import 'macro.twig' as macro %}

FROM php:{{ php.version }}-{{ php.variant }}

RUN echo 'APT::Install-Recommends "0";' >>/etc/apt/apt.conf.d/99-recommends && \
    echo 'APT::Install-Suggests "0";' >>/etc/apt/apt.conf.d/99-suggests

ENV DEBIAN_FRONTEND noninteractive

RUN apt-get update && \
    apt-get install -y automake \
                       build-essential \
                       libtool \
                       {% for package in system.packages %}{{ package }} \ 
                       {% endfor %}

    && apt-get -y autoremove && \
    rm -rf /var/lib/apt/lists/*

{% for macroName in pecl.macroList %}
{{ attribute(macro, macroName) }}
{% endfor %}

RUN pecl install {% for install in pecl.installList %}{{ install }} {% endfor %} && \
    docker-php-ext-enable {% for enable in pecl.enableList %}{{ enable }} {% endfor %}

{% block end %}
WORKDIR /var/www/{{ project.name }}
{% endblock %}

COPY php.ini /usr/local/etc/php/conf.d
