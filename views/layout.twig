{% import 'macro.twig' as macro %}
FROM php:{{ php.version }}-{{ php.variant }}
{% if system.packages is not empty or needAutomake == true %}

RUN echo 'APT::Install-Recommends "0";' >>/etc/apt/apt.conf.d/99-recommends && \
    echo 'APT::Install-Suggests "0";' >>/etc/apt/apt.conf.d/99-suggests

ENV DEBIAN_FRONTEND noninteractive

RUN apt-get update && \ 
    apt-get install -y automake \
                       build-essential \
                       libtool \
                       {% for package in system.packages %}{{ package }} \ 
                       {% endfor %}

    && apt-get -y autoremove && \
    rm -rf /var/lib/apt/lists/*

{% endif %}
{% for macroName in macroList %}
{{ attribute(macro, macroName) }}
{% endfor %}

{% if pecl.install is not empty %}
RUN pecl install {% for install in pecl.install %}{{ install }} {% endfor %}
{% endif %}

{% if extensions.install is not empty %}
RUN docker-php-ext-install {% for install in extensions.install %}{{ install }} {% endfor %}
{% endif %}

{% if pecl.enable is not empty %}
RUN docker-php-ext-enable {% for enable in pecl.enable %}{{ enable }} {% endfor %}
{% endif %}

{% block end %}

WORKDIR /var/www/{{ project.name }}
{% endblock %}

COPY php.ini /usr/local/etc/php/conf.d
